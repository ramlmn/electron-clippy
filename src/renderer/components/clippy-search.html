<link rel="import" href="./clippy-element.html">

<template id="tmpl-clippy-search">
  <style>
    :host {
      display: flex;
      width: 100%;
    }

    :host * {
      box-sizing: border-box;
    }

    #searchInput {
      width: 100%;
      padding: .8rem 1rem;
      margin: 0;
      font: inherit;
      color: var(--color-accented, inherit);
      font-size: 1.25em;
      border: none;
      cursor: text;
    }

    #searchInput:focus,
    #searchInput:active {
      border: none;
      outline: none;
    }

    ::-webkit-search-cancel-button {
      display: none;
    }
  </style>
  <input id="searchInput" type="search" placeholder="Search..." autofocus autocomplete="false">
</template>

<script>
  class ClippySearch extends ClippyElement {
    static get is() {
      return 'clippy-search';
    }

    constructor() {
      super();

      this._onKeyUp = this._onKeyUp.bind(this);
      this._onKeyDown = this._onKeyDown.bind(this);
      this._onInput = this._onInput.bind(this);
      this._onWindowKeyDown = this._onWindowKeyDown.bind(this);
    }

    ready() {
      // Add event listeners
      this.$.searchInput.addEventListener('keyup', this._onKeyUp);
      this.$.searchInput.addEventListener('keydown', this._onKeyDown);
      this.$.searchInput.addEventListener('input', this._onInput);
      window.addEventListener('keydown', this._onWindowKeyDown);
    }

    _onKeyUp(event) {
      // Left and right
      if (event.keyCode === 37 || event.keyCode === 39) {
        // Left and right, do nothing
      } else if (event.keyCode === 13) { // Enter
        Clippy.items.select();
      } else if (event.keyCode === 9) { // Tab
        // What to do on tab?
      } else {
        // Something else
      }
    }

    _onKeyDown(event) {
      if (event.keyCode === 38 || event.keyCode === 40) {
        // Prevent things for up and down
        event.preventDefault();
      }
    }

    _onInput() {
      // When 'input' occures call the items element to show results
      Clippy.items.filter(this.$.searchInput.value.trim());
    }

    _onWindowKeyDown() {
      // Damn, had to do this...
      if (document.activeElement !== this.$.searchInput) {
        this.$.searchInput.focus();
      }
    }
  }

  window.customElements.define(ClippySearch.is, ClippySearch);
</script>
