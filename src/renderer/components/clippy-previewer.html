<link rel="import" href="./clippy-element.html">

<template id="tmpl-clippy-previewer">
  <style>
    :host {
      height: 100%;
      width: 50%;
      display: flex;
      flex-direction: column;
    }

    :host * {
      box-sizing: border-box;
    }

    .preview-container {
      display: flex;
      flex: 1;
      align-items: center;
      justify-content: center;
      background: var(--color-primary-4, #fafafa);
    }

    .preview-container .text-preview {
      width: 100%;
      height: 100%;
      margin: 0;
      font-size: .875em;
      font-family: Consolas, 'SFMono-Regular', Menlo, Monaco, 'Droid Sans Mono', 'Source Code Pro',
        'DejaVu Sans Mono', 'Ubuntu Mono', Courier, monospace;
      white-space: pre;
      overflow: auto;
      line-height: 1.25;
      height: 100%;
      padding: .5em;
      color: var(--color-primary-2);
    }

    .preview-container .img-preview {
      width: 100%;
      height: 100%;
      padding: .5em;
      object-fit: contain;
      background-image: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%202%202%22%3E%3Cpath%20d%3D%22M1%202V0h1v1H0v1z%22%20fill-opacity%3D%22.05%22%2F%3E%3C%2Fsvg%3E');
      background-size: 1rem;
    }

    .cb-item-meta {
      padding: .5rem;
      text-align: center;
      font-size: .75em;
      color: var(--color-primary-3);
    }

    .hidden {
      display: none;
    }

    /* Webkit scrollbar styles */
    ::-webkit-scrollbar {
      height: 8px;
      width: 3px;
    }

    ::-webkit-scrollbar:horizontal {
      height: 3px;
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: 0;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--color-scrollbar);
    }

    ::-webkit-scrollbar-corner {
      background: 0;
    }
  </style>
  <div class="preview-container">
    <pre class="text-preview hidden" id="code"></pre>
    <img class="img-preview hidden" id="img"></img>
  </div>
  <div class="cb-item-meta">
    <div class="cb-item-info" id="info">&nbsp;</div>
    <div class="cb-item-created-at" id="time">&nbsp;</div>
  </div>
</template>

<script>
  class ClippyPreviewer extends ClippyElement {
    static get is() {
      return 'clippy-previewer';
    }

    preview(item = null) {
      this.$.code.classList.add('hidden');
      this.$.img.classList.add('hidden');

      if (!item) {
        // If there is not item passed, hide things,
        // its used to hide thing when no items are available
        this.$.info.innerHTML = '&nbsp;';
        this.$.time.innerHTML = '&nbsp;';
        return;
      }

      // Preview the item
      if (item.type === 'text') {
        const content = item.text;
        const length = [...content].length;
        const time = this._formatTime(item.timestamp);

        this.$.code.classList.remove('hidden');
        this.$.code.textContent = content;
        this.$.info.textContent = `${length} chars`;
        this.$.time.textContent = `Copied at ${time}`;
      } else if (item.type === 'image') {
        const length = item.size;
        const size = this._formatSize(length);
        const time = this._formatTime(item.timestamp);

        this.$.img.classList.remove('hidden');
        this.$.img.src = item.thumb;
        this.$.info.textContent = `${item.width}x${item.height} (${size})`;
        this.$.time.textContent = `Copied at ${time}`;
      } else {
        // Nothing I know of
      }
    }

    // Convert bytes to 'multiple' representation
    _formatSize(bytes) {
      const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
      const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
      return `${Math.round(bytes / Math.pow(1024, i), 2)} ${sizes[i]}`;
    }

    // Format UNIX timestamp to simple hour and minute form - HH:MM
    _formatTime(timestamp) {
      const d = new Date(timestamp);
      const time = `${d.getHours()}:${d.getMinutes()}`;
      return time;
    }
  }

  window.customElements.define(ClippyPreviewer.is, ClippyPreviewer);
</script>
