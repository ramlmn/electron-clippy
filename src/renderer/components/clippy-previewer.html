<link rel="import" href="./clippy-element.html">

<template id="tmpl-clippy-previewer">
  <style>
    :host {
      height: 100%;
      width: 50%;
      display: flex;
      flex-direction: column;
    }

    :host * {
      box-sizing: border-box;
    }

    .preview-container {
      display: flex;
      flex: 1;
      align-items: center;
      justify-content: center;
      background: var(--color-primary-4, #fafafa);
      position: relative;
    }

    .preview-container .text-preview,
    .preview-container .img-preview {
      width: 100%;
      height: 100%;
      padding: .5em;
    }

    .preview-container .text-preview {
      margin: 0;
      font-size: .875em;
      font-family: Consolas, 'SFMono-Regular', Menlo, Monaco, 'Droid Sans Mono', 'Source Code Pro',
        'DejaVu Sans Mono', 'Ubuntu Mono', Courier, monospace;
      white-space: pre;
      overflow: auto;
      line-height: 1.25;
      color: var(--color-primary-2);
    }

    .preview-container .img-preview {
      object-fit: contain;
      background-image: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%202%202%22%3E%3Cpath%20d%3D%22M1%202V0h1v1H0v1z%22%20fill-opacity%3D%22.05%22%2F%3E%3C%2Fsvg%3E');
      background-size: 1rem;
    }

    .cb-item-meta {
      padding: .5rem;
      text-align: center;
      font-size: .75em;
      color: var(--color-primary-3);
    }

    .hidden {
      display: none;
    }

    /* Webkit scrollbar styles */
    ::-webkit-scrollbar {
      height: 8px;
      width: 3px;
    }

    ::-webkit-scrollbar:horizontal {
      height: 3px;
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: 0;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--color-scrollbar);
    }

    ::-webkit-scrollbar-corner {
      background: 0;
    }
  </style>
  <div class="preview-container">
    <pre class="text-preview hidden" id="code"></pre>
    <img class="img-preview hidden" id="img"></img>
  </div>
  <div class="cb-item-meta">
    <div class="cb-item-info" id="info">&nbsp;</div>
    <div class="cb-item-created-at" id="time">&nbsp;</div>
  </div>
</template>

<script>
  (_ => {
    class ClippyPreviewer extends ClippyElement {
      static get is() {
        return 'clippy-previewer';
      }

      preview(item = null) {
        if (!item) {
          // If there is not item passed, hide things,
          // its used to hide thing when no items are available
          this.$.info.innerHTML = '&nbsp;';
          this.$.time.innerHTML = '&nbsp;';
          this.$.code.classList.add('hidden');
          this.$.img.classList.add('hidden');
          return;
        }

        const time = this._formatTime(item.timestamp);
        this.$.time.textContent = `Copied at ${time}`;

        if (item.type === 'text') {
          this.$.img.classList.add('hidden');
          this.$.code.classList.remove('hidden');
          this.$.info.textContent = `${item.length} chars`;

          this.$.code.textContent = item.data.text;
        } else if (item.type === 'image') {
          this.$.code.classList.add('hidden');
          this.$.img.classList.remove('hidden');
          this.$.info.textContent = `${item.width}x${item.height}`;

          this.$.img.src = item.thumb;
        } else {
          // Nothing I know of
        }
      }

      // Format UNIX timestamp to simple hour and minute form - HH:MM
      _formatTime(timestamp) {
        const d = new Date(timestamp);
        const time = `${d.getHours()}:${d.getMinutes()}`;
        return time;
      }
    }

    window.customElements.define(ClippyPreviewer.is, ClippyPreviewer);
  })();
</script>
